<section class="page users-page mat-light-override">
  <div class="header">
    <div>
      <div class="breadcrumb">Portal / Employees</div>
      <h1 class="title">Employees</h1>
      <div class="subtitle">Manage admins, managers, and staff</div>
    </div>

    <div class="actions">
      <mat-form-field appearance="outline" class="w240">
        <mat-label>Search name or email</mat-label>
        <input class="search" matInput (keyup)="applyQuickFilter($event)" placeholder="Type to filterâ€¦" />
      </mat-form-field>

      <button mat-flat-button color="primary" (click)="onAdd()" *ngIf="isOwnerOrAdmin()">
        <mat-icon>person_add</mat-icon><span>Add user</span>
      </button>
    </div>
  </div>

  <mat-card class="mat-elevation-z1 users-card">
    <mat-card-content>
      <div class="table-wrap">
        <table mat-table [dataSource]="dataSource" class="users-table">

           <!-- Name -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Name</th>
            <td mat-cell *matCellDef="let row">
            <div class="user-cell">
              <div class="avatar"><mat-icon aria-hidden="true">person</mat-icon></div>
              <div class="user-meta">
                <div class="user-name">{{ row.name }}</div>
                <div class="user-email">{{ row.email }}</div>

                <!-- Mini actions live *inside* .user-meta -->
                <div class="mini-actions">
                  <button class="mini view" mat-stroked-button (click)="onView(row)">
                    <mat-icon>visibility</mat-icon><span>View</span>
                  </button>
                  <button class="mini edit" mat-stroked-button (click)="onEdit(row)" *ngIf="canEdit(row.email)">
                    <mat-icon>edit</mat-icon><span>Edit</span>
                  </button>
                  <button class="mini delete" mat-stroked-button color="warn"
                          (click)="onDelete(row)" *ngIf="canHardDelete(row.email)">
                    <mat-icon>delete</mat-icon><span>Delete</span>
                  </button>
                  <button class="mini" mat-stroked-button color="warn"
                          (click)="onRequestDelete(row)" *ngIf="canRequestDeletion(row.email)">
                    <mat-icon>delete_outline</mat-icon><span>Request</span>
                  </button>
                </div>
              </div>
            </div>
          </td>
          </ng-container>


          <!-- Roles -->
          <ng-container matColumnDef="roles">
            <th mat-header-cell *matHeaderCellDef>Roles</th>
            <td mat-cell *matCellDef="let row">
              <mat-chip-set aria-label="Roles">
                <mat-chip *ngFor="let r of row.roles" class="role-chip">{{ r }}</mat-chip>
              </mat-chip-set>
            </td>
          </ng-container>

          <!-- Locations -->
          <ng-container matColumnDef="locations">
            <th mat-header-cell *matHeaderCellDef>Locations</th>
            <td mat-cell *matCellDef="let row">
              <mat-chip-set aria-label="Locations">
                <mat-chip *ngFor="let l of row.locations" class="loc-chip">{{ l }}</mat-chip>
              </mat-chip-set>
            </td>
          </ng-container>

          <!-- Performance -->
          <ng-container matColumnDef="performance">
            <th mat-header-cell *matHeaderCellDef>Performance</th>
            <td mat-cell *matCellDef="let row">
              <button class="viewPerformance" mat-stroked-button (click)="onViewPerformance(row)" *ngIf="canViewPerformance(row.email)">
                <mat-icon>bar_chart</mat-icon><span>View</span>
              </button>
            </td>
          </ng-container>

          <!-- Actions -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="col-actions">Actions</th>
            <td mat-cell *matCellDef="let row" class="col-actions">
              <button class="view" mat-button (click)="onView(row)">
                <mat-icon>visibility</mat-icon><span>View</span>
              </button>
              <button class="edit" mat-button (click)="onEdit(row)" *ngIf="canEdit(row.email)">
                <mat-icon>edit</mat-icon><span>Edit</span>
              </button>
              <button class="delete" mat-button color="warn" (click)="onDelete(row)" *ngIf="canHardDelete(row.email)">
                <mat-icon>delete</mat-icon><span>Delete</span>
              </button>
              <button mat-stroked-button color="warn" (click)="onRequestDelete(row)" *ngIf="canRequestDeletion(row.email)">
                <mat-icon>delete_outline</mat-icon><span>Request Deletion</span>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>

      <mat-paginator [pageSize]="8" [pageSizeOptions]="[5,8,10,20]"></mat-paginator>
    </mat-card-content>
  </mat-card>
</section>
